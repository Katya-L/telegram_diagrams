sequenceDiagram

    actor U1 as Sender
    participant C as Client
    participant S as Smart-contract
    participant W as CryptoWallet
    actor U2 as Receiver 

    U1 ->> C: 1. Нажатие кнопки отправить
    C ->> C: 2. Запрос ввода имени пользователя получателя
    U1 ->> C: 3. Ввод имени пользователя
    C ->> S: 4. Запрос на подтверждение
    S ->> S: 5. Сопоставление имени пользователя адреса кошелька
    S ->> W: 6. Запрос на подтверждение адреса
    W ->> W: 7. Поиск кошелька
    W -->> S: 8. Подтверждение адреса
    S -->> C: 9. Подтверждение адреса

    C ->> S: 10. Запрос баланса пользователя
    S -->> C: 11. Баланс
    C ->> C: 12. Отображение баланса
    C ->> C: 13. Запрос ввода суммы перевода и валюты
    U1 ->> C: 14. Ввод суммы и валюты

    C ->> S: 15. Запрос расчета газа
    S ->> W: 16. Запрос данных о курсе
    W -->> S: 17. Курс
    S ->> S: 18. Расчет газа
    S -->> C: 19. Газ
    C ->> C: 20. Расчет итоговой суммы
    C ->> C: 21. Проверка достаточности средств с учетом оплаты газа

    alt Средств достаточно
        U1 ->> C: 22. Нажатие кнопки далее
        C ->> C: 23. Отображение газа и итоговой суммы
        U1 ->> C: 24. Подтверждение транзакции
        C ->> S: 25. Запрос на транзакцию
        S ->> S: 26. Проверка транзакции
        S ->> W: 27. Запрос на транзакцию
        W ->> W: 28. Проверка транзакции
        W ->> W: 29. Добавление транзакции в очередь
        W -->> S: 30. Статус: в ожидании
        S -->> C: 31. Статус: в ожидании
        C ->> C: 32. Отображение статуса

        W ->> W: 33. Блок с транзакцией добавлен в блокчейн
        W -->> S: 34. Транзакция
        S ->> S: 35. Транзакция добавлена в истории пользователей
        S ->> S: 36. Пересчет баланса пользователей
        S -->> C: 37. Транзакция

        par 
            C ->> U1: 38. Уведомление о транзакции
        and 
            C ->> U2: 38. Уведомление о транзакции
        end

    else Средств недостаточно
        C ->> C: 22a. Отображение сообщения ошибки
    end
    
